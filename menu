#!/bin/bash

# Function to add record to text file
addRecord() {
	echo "Please fill out the following fields of information:"
	echo "NOTE: Do not use colons(:) in any of the data entries"
	read -p 'Name: ' userName
	read -p 'Address: ' userAddress
	read -p 'Phone: ' userPhone
	read -p 'Email: ' userEmail

	echo $userName:$userAddress:$userPhone:$userEmail >> database.txt
}

# Print is used to read contents of input file. 
print() {
	IFS=":"
	echo -e "Name\t\tAddress\t\tPhone\t\tEmail"
	while read name address phone email;
	do
		echo -e "$name\t$address\t$phone\t$email"
	done <database.txt
}

#Function finds one or more records in database
find(){
DATABASE="database.txt"

echo "Enter a record to find: "
read input

RECORD=$(grep -i $input $DATABASE)

for line in "$RECORD"
do
	if [ $? == 1 ]; #a '1' indicates that no matches were found
	then
		echo "Could not find the requested record"
	else
		echo "Found the requested record: $line"
	fi
done
}

# Function updates record user
update(){
read -p "Please enter the first and last name on the file you wish to change: " firstName
grep  "^$firstName" ./database.txt
lnNmbr="grep -c \"^$firstName\" ./database.txt "
if test "eval $lnNmbr">1
	then touch dataTemp
	grep "^$firstName" ./database.txt > ./dataTemp
	read -p "Input the line number of the: " lineNumber
	holder="head -n "$lineNumber" ./dataTemp | tail -n "\+$lineNumber" " 
	#eval $holder > ./dataTemp
	firstName=$(eval $holder)
	echo "$firstName"
	rm dataTemp

fi

read -p "Is this the file you wish to update?(y/n)" data
if test "$data" = "y" 
	then grep -v "^$firstName" ./database.txt > ./dataBaseHolder
	read -p "Enter first and last name: " newName
	read -p "Enter address: " newAdd
	read -p "Enter phone: " newPhone
	read -p "Enter email: " newEmail
	echo "$newName:$newAdd:$newPhone:$newEmail" >> ./dataBaseHolder
	mv ./dataBaseHolder ./database.txt
	echo "DataBase"
	print
else
	upDate
fi

}


# Interative menu 
menu(){
echo "Welcome to my contact database, please select in the following menu:"
echo "(a) Find a record"
echo "(b) Add a new record"
echo "(c) Update a record"
echo "(d) Remove a record"
echo "(e) Display Contacts"
echo "(f) Quit"
echo "> Selection is:"

while :
do 
   read input
   case $input in 
      [aA])
         #call find record function
	 find
         break ;;
      [bB])
         #call Add new record function
         addRecord
         break ;;
      [cC])
         #call Update record function
	 update
         break ;;
      [dD])
         #call Remove record function
         break ;;
      [eE])
      	 #call print function
	 print
	 break;;
      [fF])
         echo "Thank you! Goodbye"
         exit ;; 
      *)
         echo "Sorry that isn't an option, select again.";;
   esac
done 
}
touch database.txt::
answer=1
while [ $answer -eq 1 ] 
do 
   menu
   echo "Would you like to select again(y/n)?"
   while :
   do   
      read response
      case $response in
         [yY]) answer=1 
            break ;;
         [nN]) answer=0 
            break ;;
         *) echo "Invalid response please enter again."
      esac
   done
done
echo "Thank you! Goodbye"
